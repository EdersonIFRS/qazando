import{r as p,bJ as Y,bd as D,a$ as X,b0 as k,b1 as A,b3 as b,b6 as E,b2 as pe,be,bf as fe,ba as H,b4 as z,b5 as ve,b7 as N,bF as xe,bG as ge,bH as Oe,b8 as M,b9 as G,bc as me,bK as Re,bg as O,bh as Se,bi as j,bm as he}from"./index-462dc4aa.js";import{u as Le,a as L,x as ye}from"./use-tracked-pointer-7e5ced16.js";import{s as Ie}from"./use-resolve-button-type-76085efc.js";import{T as $e,e as Pe}from"./use-controllable-a3e8dfb8.js";function Z(e,a){let[i,o]=p.useState(e),n=Y(e);return D(()=>o(n.current),[n,o,...a]),i}var Te=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Te||{}),Ce=(e=>(e[e.Single=0]="Single",e[e.Multi=1]="Multi",e))(Ce||{}),Ee=(e=>(e[e.Pointer=0]="Pointer",e[e.Other=1]="Other",e))(Ee||{}),we=(e=>(e[e.OpenListbox=0]="OpenListbox",e[e.CloseListbox=1]="CloseListbox",e[e.GoToOption=2]="GoToOption",e[e.Search=3]="Search",e[e.ClearSearch=4]="ClearSearch",e[e.RegisterOption=5]="RegisterOption",e[e.UnregisterOption=6]="UnregisterOption",e[e.RegisterLabel=7]="RegisterLabel",e))(we||{});function V(e,a=i=>i){let i=e.activeOptionIndex!==null?e.options[e.activeOptionIndex]:null,o=he(a(e.options.slice()),c=>c.dataRef.current.domRef.current),n=i?o.indexOf(i):null;return n===-1&&(n=null),{options:o,activeOptionIndex:n}}let De={[1](e){return e.dataRef.current.disabled||e.listboxState===1?e:{...e,activeOptionIndex:null,listboxState:1}},[0](e){if(e.dataRef.current.disabled||e.listboxState===0)return e;let a=e.activeOptionIndex,{isSelected:i}=e.dataRef.current,o=e.options.findIndex(n=>i(n.dataRef.current.value));return o!==-1&&(a=o),{...e,listboxState:0,activeOptionIndex:a}},[2](e,a){var i;if(e.dataRef.current.disabled||e.listboxState===1)return e;let o=V(e),n=ye(a,{resolveItems:()=>o.options,resolveActiveIndex:()=>o.activeOptionIndex,resolveId:c=>c.id,resolveDisabled:c=>c.dataRef.current.disabled});return{...e,...o,searchQuery:"",activeOptionIndex:n,activationTrigger:(i=a.trigger)!=null?i:1}},[3]:(e,a)=>{if(e.dataRef.current.disabled||e.listboxState===1)return e;let i=e.searchQuery!==""?0:1,o=e.searchQuery+a.value.toLowerCase(),n=(e.activeOptionIndex!==null?e.options.slice(e.activeOptionIndex+i).concat(e.options.slice(0,e.activeOptionIndex+i)):e.options).find(t=>{var r;return!t.dataRef.current.disabled&&((r=t.dataRef.current.textValue)==null?void 0:r.startsWith(o))}),c=n?e.options.indexOf(n):-1;return c===-1||c===e.activeOptionIndex?{...e,searchQuery:o}:{...e,searchQuery:o,activeOptionIndex:c,activationTrigger:1}},[4](e){return e.dataRef.current.disabled||e.listboxState===1||e.searchQuery===""?e:{...e,searchQuery:""}},[5]:(e,a)=>{let i={id:a.id,dataRef:a.dataRef},o=V(e,n=>[...n,i]);return e.activeOptionIndex===null&&e.dataRef.current.isSelected(a.dataRef.current.value)&&(o.activeOptionIndex=o.options.indexOf(i)),{...e,...o}},[6]:(e,a)=>{let i=V(e,o=>{let n=o.findIndex(c=>c.id===a.id);return n!==-1&&o.splice(n,1),o});return{...e,...i,activationTrigger:1}},[7]:(e,a)=>({...e,labelId:a.id})},W=p.createContext(null);W.displayName="ListboxActionsContext";function F(e){let a=p.useContext(W);if(a===null){let i=new Error(`<${e} /> is missing a parent <Listbox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(i,F),i}return a}let q=p.createContext(null);q.displayName="ListboxDataContext";function Q(e){let a=p.useContext(q);if(a===null){let i=new Error(`<${e} /> is missing a parent <Listbox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(i,Q),i}return a}function ke(e,a){return E(a.type,De,e,a)}let Ae=p.Fragment;function Me(e,a){let{value:i,defaultValue:o,name:n,onChange:c,by:t=(s,d)=>s===d,disabled:r=!1,horizontal:m=!1,multiple:x=!1,...h}=e;const y=m?"horizontal":"vertical";let T=A(a),[R=x?[]:void 0,$]=$e(i,c,o),[P,u]=p.useReducer(ke,{dataRef:p.createRef(),listboxState:1,options:[],searchQuery:"",labelId:null,activeOptionIndex:null,activationTrigger:1}),l=p.useRef({static:!1,hold:!1}),f=p.useRef(null),C=p.useRef(null),K=p.useRef(null),g=b(typeof t=="string"?(s,d)=>{let S=t;return(s==null?void 0:s[S])===(d==null?void 0:d[S])}:t),I=p.useCallback(s=>E(v.mode,{[1]:()=>R.some(d=>g(d,s)),[0]:()=>g(R,s)}),[R]),v=p.useMemo(()=>({...P,value:R,disabled:r,mode:x?1:0,orientation:y,compare:g,isSelected:I,optionsPropsRef:l,labelRef:f,buttonRef:C,optionsRef:K}),[R,r,x,P]);D(()=>{P.dataRef.current=v},[v]),pe([v.buttonRef,v.optionsRef],(s,d)=>{var S;u({type:1}),be(d,fe.Loose)||(s.preventDefault(),(S=v.buttonRef.current)==null||S.focus())},v.listboxState===0);let _=p.useMemo(()=>({open:v.listboxState===0,disabled:r,value:R}),[v,r,R]),ee=b(s=>{let d=v.options.find(S=>S.id===s);d&&w(d.dataRef.current.value)}),te=b(()=>{if(v.activeOptionIndex!==null){let{dataRef:s,id:d}=v.options[v.activeOptionIndex];w(s.current.value),u({type:2,focus:L.Specific,id:d})}}),oe=b(()=>u({type:0})),ne=b(()=>u({type:1})),re=b((s,d,S)=>s===L.Specific?u({type:2,focus:L.Specific,id:d,trigger:S}):u({type:2,focus:s,trigger:S})),ae=b((s,d)=>(u({type:5,id:s,dataRef:d}),()=>u({type:6,id:s}))),ie=b(s=>(u({type:7,id:s}),()=>u({type:7,id:null}))),w=b(s=>E(v.mode,{[0](){return $==null?void 0:$(s)},[1](){let d=v.value.slice(),S=d.findIndex(U=>g(U,s));return S===-1?d.push(s):d.splice(S,1),$==null?void 0:$(d)}})),le=b(s=>u({type:3,value:s})),se=b(()=>u({type:4})),ue=p.useMemo(()=>({onChange:w,registerOption:ae,registerLabel:ie,goToOption:re,closeListbox:ne,openListbox:oe,selectActiveOption:te,selectOption:ee,search:le,clearSearch:se}),[]),ce={ref:T},B=p.useRef(null),de=H();return p.useEffect(()=>{B.current&&o!==void 0&&de.addEventListener(B.current,"reset",()=>{w(o)})},[B,w]),z.createElement(W.Provider,{value:ue},z.createElement(q.Provider,{value:v},z.createElement(ve,{value:E(v.listboxState,{[0]:N.Open,[1]:N.Closed})},n!=null&&R!=null&&Pe({[n]:R}).map(([s,d],S)=>z.createElement(xe,{features:ge.Hidden,ref:S===0?U=>{var J;B.current=(J=U==null?void 0:U.closest("form"))!=null?J:null}:void 0,...Oe({key:s,as:"input",type:"hidden",hidden:!0,readOnly:!0,name:s,value:d})})),M({ourProps:ce,theirProps:h,slot:_,defaultTag:Ae,name:"Listbox"}))))}let Fe="button";function Qe(e,a){var i;let o=G(),{id:n=`headlessui-listbox-button-${o}`,...c}=e,t=Q("Listbox.Button"),r=F("Listbox.Button"),m=A(t.buttonRef,a),x=H(),h=b(u=>{switch(u.key){case O.Space:case O.Enter:case O.ArrowDown:u.preventDefault(),r.openListbox(),x.nextFrame(()=>{t.value||r.goToOption(L.First)});break;case O.ArrowUp:u.preventDefault(),r.openListbox(),x.nextFrame(()=>{t.value||r.goToOption(L.Last)});break}}),y=b(u=>{switch(u.key){case O.Space:u.preventDefault();break}}),T=b(u=>{if(Se(u.currentTarget))return u.preventDefault();t.listboxState===0?(r.closeListbox(),x.nextFrame(()=>{var l;return(l=t.buttonRef.current)==null?void 0:l.focus({preventScroll:!0})})):(u.preventDefault(),r.openListbox())}),R=Z(()=>{if(t.labelId)return[t.labelId,n].join(" ")},[t.labelId,n]),$=p.useMemo(()=>({open:t.listboxState===0,disabled:t.disabled,value:t.value}),[t]),P={ref:m,id:n,type:Ie(e,t.buttonRef),"aria-haspopup":"listbox","aria-controls":(i=t.optionsRef.current)==null?void 0:i.id,"aria-expanded":t.disabled?void 0:t.listboxState===0,"aria-labelledby":R,disabled:t.disabled,onKeyDown:h,onKeyUp:y,onClick:T};return M({ourProps:P,theirProps:c,slot:$,defaultTag:Fe,name:"Listbox.Button"})}let Be="label";function Ue(e,a){let i=G(),{id:o=`headlessui-listbox-label-${i}`,...n}=e,c=Q("Listbox.Label"),t=F("Listbox.Label"),r=A(c.labelRef,a);D(()=>t.registerLabel(o),[o]);let m=b(()=>{var h;return(h=c.buttonRef.current)==null?void 0:h.focus({preventScroll:!0})}),x=p.useMemo(()=>({open:c.listboxState===0,disabled:c.disabled}),[c]);return M({ourProps:{ref:r,id:o,onClick:m},theirProps:n,slot:x,defaultTag:Be,name:"Listbox.Label"})}let ze="ul",He=X.RenderStrategy|X.Static;function Ne(e,a){var i;let o=G(),{id:n=`headlessui-listbox-options-${o}`,...c}=e,t=Q("Listbox.Options"),r=F("Listbox.Options"),m=A(t.optionsRef,a),x=H(),h=H(),y=me(),T=(()=>y!==null?(y&N.Open)===N.Open:t.listboxState===0)();p.useEffect(()=>{var l;let f=t.optionsRef.current;f&&t.listboxState===0&&f!==((l=Re(f))==null?void 0:l.activeElement)&&f.focus({preventScroll:!0})},[t.listboxState,t.optionsRef]);let R=b(l=>{switch(h.dispose(),l.key){case O.Space:if(t.searchQuery!=="")return l.preventDefault(),l.stopPropagation(),r.search(l.key);case O.Enter:if(l.preventDefault(),l.stopPropagation(),t.activeOptionIndex!==null){let{dataRef:f}=t.options[t.activeOptionIndex];r.onChange(f.current.value)}t.mode===0&&(r.closeListbox(),j().nextFrame(()=>{var f;return(f=t.buttonRef.current)==null?void 0:f.focus({preventScroll:!0})}));break;case E(t.orientation,{vertical:O.ArrowDown,horizontal:O.ArrowRight}):return l.preventDefault(),l.stopPropagation(),r.goToOption(L.Next);case E(t.orientation,{vertical:O.ArrowUp,horizontal:O.ArrowLeft}):return l.preventDefault(),l.stopPropagation(),r.goToOption(L.Previous);case O.Home:case O.PageUp:return l.preventDefault(),l.stopPropagation(),r.goToOption(L.First);case O.End:case O.PageDown:return l.preventDefault(),l.stopPropagation(),r.goToOption(L.Last);case O.Escape:return l.preventDefault(),l.stopPropagation(),r.closeListbox(),x.nextFrame(()=>{var f;return(f=t.buttonRef.current)==null?void 0:f.focus({preventScroll:!0})});case O.Tab:l.preventDefault(),l.stopPropagation();break;default:l.key.length===1&&(r.search(l.key),h.setTimeout(()=>r.clearSearch(),350));break}}),$=Z(()=>{var l,f,C;return(C=(l=t.labelRef.current)==null?void 0:l.id)!=null?C:(f=t.buttonRef.current)==null?void 0:f.id},[t.labelRef.current,t.buttonRef.current]),P=p.useMemo(()=>({open:t.listboxState===0}),[t]),u={"aria-activedescendant":t.activeOptionIndex===null||(i=t.options[t.activeOptionIndex])==null?void 0:i.id,"aria-multiselectable":t.mode===1?!0:void 0,"aria-labelledby":$,"aria-orientation":t.orientation,id:n,onKeyDown:R,role:"listbox",tabIndex:0,ref:m};return M({ourProps:u,theirProps:c,slot:P,defaultTag:ze,features:He,visible:T,name:"Listbox.Options"})}let Ge="li";function Ke(e,a){let i=G(),{id:o=`headlessui-listbox-option-${i}`,disabled:n=!1,value:c,...t}=e,r=Q("Listbox.Option"),m=F("Listbox.Option"),x=r.activeOptionIndex!==null?r.options[r.activeOptionIndex].id===o:!1,h=r.isSelected(c),y=p.useRef(null),T=Y({disabled:n,value:c,domRef:y,get textValue(){var g,I;return(I=(g=y.current)==null?void 0:g.textContent)==null?void 0:I.toLowerCase()}}),R=A(a,y);D(()=>{if(r.listboxState!==0||!x||r.activationTrigger===0)return;let g=j();return g.requestAnimationFrame(()=>{var I,v;(v=(I=y.current)==null?void 0:I.scrollIntoView)==null||v.call(I,{block:"nearest"})}),g.dispose},[y,x,r.listboxState,r.activationTrigger,r.activeOptionIndex]),D(()=>m.registerOption(o,T),[T,o]);let $=b(g=>{if(n)return g.preventDefault();m.onChange(c),r.mode===0&&(m.closeListbox(),j().nextFrame(()=>{var I;return(I=r.buttonRef.current)==null?void 0:I.focus({preventScroll:!0})}))}),P=b(()=>{if(n)return m.goToOption(L.Nothing);m.goToOption(L.Specific,o)}),u=Le(),l=b(g=>u.update(g)),f=b(g=>{u.wasMoved(g)&&(n||x||m.goToOption(L.Specific,o,0))}),C=b(g=>{u.wasMoved(g)&&(n||x&&m.goToOption(L.Nothing))}),K=p.useMemo(()=>({active:x,selected:h,disabled:n}),[x,h,n]);return M({ourProps:{id:o,ref:R,role:"option",tabIndex:n===!0?void 0:-1,"aria-disabled":n===!0?!0:void 0,"aria-selected":h,disabled:void 0,onClick:$,onFocus:P,onPointerEnter:l,onMouseEnter:l,onPointerMove:f,onMouseMove:f,onPointerLeave:C,onMouseLeave:C},theirProps:t,slot:K,defaultTag:Ge,name:"Listbox.Option"})}let Ve=k(Me),je=k(Qe),We=k(Ue),qe=k(Ne),Je=k(Ke),et=Object.assign(Ve,{Button:je,Label:We,Options:qe,Option:Je});export{et as B};
